<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <link rel="stylesheet" href="jquery-ui.min.css" />
    <link rel="stylesheet" href="styles.css" />
    <script type="text/javascript" src="jquery-3.1.1.min.js"></script>
    <script type="text/javascript" src="jquery-ui.min.js"></script>
    <title>Aristrocrat Encrypt</title>
</head>

<body>
    <a href="index.html">Back to Cipher Tools</a>
    <h1>
        Aristrocrat Encrypt</h1>

    <hr />
    <label for="toencode">
        Text to encode</label>
    <textarea id="toencode" cols="20" rows="2"></textarea>
    <br/>
    <label for="radios">Alphabet Type</label>
    <div id="radios" class="ibox">
        <input id="encrand" type="radio" name="enctype" value="random" checked="checked" />
        <label for="encrand" class="rlab">Random</label>
        <input id="enck1" type="radio" name="enctype" value="k1" />
        <label for="enck1" class="rlab">K1</label>
        <input id="enck2" type="radio" name="enctype" value="k2" />
        <label for="enck2" class="rlab">K2</label>
        <input id="enck3" type="radio" name="enctype" value="k3" />
        <label for="enck3" class="rlab">K3</label>
        <input id="enck3" type="radio" name="enctype" value="k4" />
        <label for="enck3" class="rlab">K4</label>
    </div>
    <div class="kval">
        <label for="keyword">
            Keyword</label>
        <input type="text" id="keyword" />
        <div>
            <label for="offset">
                Offset</label>
            <input id="offset" class="inp spin" title="offset" type="text" value="1" />
        </div>
    </div>
    <div class="k4val">
        <label for="keyword2">
            Keyword 2</label>
        <input type="text" id="keyword2" />
        <div>
            <label for="offset2">
                Offset</label>
            <input id="offset2" class="inp spin" title="offset" type="text" value="1" />
        </div>
    </div>
    <div class="k3val">
        <div>
            <label for="offset">
                Shift</label>
            <input id="shift" class="inp spin" title="offset" type="text" value="1" />
        </div>
    </div>
    <div class="err" id="err">
    </div>
    <input id="encrypt" type="button" value="encrypt" />
    <hr />
    <div class="ans" id="answer">
    </div>
    <div class="freq">
        <table class="tfreq">
            <thead>
                <tr>
                    <th class="topleft">
                        &nbsp;
                    </th>
                    <th>
                        A
                    </th>
                    <th>
                        B
                    </th>
                    <th>
                        C
                    </th>
                    <th>
                        D
                    </th>
                    <th>
                        E
                    </th>
                    <th>
                        F
                    </th>
                    <th>
                        G
                    </th>
                    <th>
                        H
                    </th>
                    <th>
                        I
                    </th>
                    <th>
                        J
                    </th>
                    <th>
                        K
                    </th>
                    <th>
                        L
                    </th>
                    <th>
                        M
                    </th>
                    <th>
                        N
                    </th>
                    <th>
                        O
                    </th>
                    <th>
                        P
                    </th>
                    <th>
                        Q
                    </th>
                    <th>
                        R
                    </th>
                    <th>
                        S
                    </th>
                    <th>
                        T
                    </th>
                    <th>
                        U
                    </th>
                    <th>
                        V
                    </th>
                    <th>
                        W
                    </th>
                    <th>
                        X
                    </th>
                    <th>
                        Y
                    </th>
                    <th>
                        Z
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <th>
                        Frequency
                    </th>
                    <td id="fA">
                        &nbsp;
                    </td>
                    <td id="fB">
                        &nbsp;
                    </td>
                    <td id="fC">
                        &nbsp;
                    </td>
                    <td id="fD">
                        &nbsp;
                    </td>
                    <td id="fE">
                        &nbsp;
                    </td>
                    <td id="fF">
                        &nbsp;
                    </td>
                    <td id="fG">
                        &nbsp;
                    </td>
                    <td id="fH">
                    </td>
                    <td id="fI">
                    </td>
                    <td id="fJ">
                    </td>
                    <td id="fK">
                    </td>
                    <td id="fL">
                        &nbsp;
                    </td>
                    <td id="fM">
                        &nbsp;
                    </td>
                    <td id="fN">
                        &nbsp;
                    </td>
                    <td id="fO">
                        &nbsp;
                    </td>
                    <td id="fP">
                        &nbsp;
                    </td>
                    <td id="fQ">
                        &nbsp;
                    </td>
                    <td id="fR">
                        &nbsp;
                    </td>
                    <td id="fS">
                        &nbsp;
                    </td>
                    <td id="fT">
                        &nbsp;
                    </td>
                    <td id="fU">
                        &nbsp;
                    </td>
                    <td id="fV">
                        &nbsp;
                    </td>
                    <td id="fW">
                        &nbsp;
                    </td>
                    <td id="fX">
                        &nbsp;
                    </td>
                    <td id="fY">
                        &nbsp;
                    </td>
                    <td id="fZ">
                        &nbsp;
                    </td>
                </tr>
                <tr>
                    <th>
                        Replacement
                    </th>
                    <td id="rA">
                        &nbsp;
                    </td>
                    <td id="rB">
                        &nbsp;
                    </td>
                    <td id="rC">
                        &nbsp;
                    </td>
                    <td id="rD">
                        &nbsp;
                    </td>
                    <td id="rE">
                        &nbsp;
                    </td>
                    <td id="rF">
                        &nbsp;
                    </td>
                    <td id="rG">
                        &nbsp;
                    </td>
                    <td id="rH">
                        &nbsp;
                    </td>
                    <td id="rI">
                        &nbsp;
                    </td>
                    <td id="rJ">
                        &nbsp;
                    </td>
                    <td id="rK">
                        &nbsp;
                    </td>
                    <td id="rL">
                        &nbsp;
                    </td>
                    <td id="rM">
                        &nbsp;
                    </td>
                    <td id="rN">
                        &nbsp;
                    </td>
                    <td id="rO">
                        &nbsp;
                    </td>
                    <td id="rP">
                        &nbsp;
                    </td>
                    <td id="rQ">
                        &nbsp;
                    </td>
                    <td id="rR">
                        &nbsp;
                    </td>
                    <td id="rS">
                        &nbsp;
                    </td>
                    <td id="rT">
                        &nbsp;
                    </td>
                    <td id="rU">
                        &nbsp;
                    </td>
                    <td id="rV">
                        &nbsp;
                    </td>
                    <td id="rW">
                        &nbsp;
                    </td>
                    <td id="rX">
                        &nbsp;
                    </td>
                    <td id="rY">
                        &nbsp;
                    </td>
                    <td id="rZ">
                        &nbsp;
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <script type="text/javascript">
        var charset = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        var unasigned = "";
        var replacement = "";
        var freq = [];

        function genMap() {
            var val = $('input[name=enctype]:checked').val();
            var keyword = $('#keyword').val();
            var offset = $('#offset').spinner("value");
            var keyword2 = $('#keyword2').val();
            var offset2 = $('#offset2').spinner("value");
            var shift = $('#shift').spinner("value");
            if (val === 'random') {
                genRandom();
            } else if (val === 'k1') {
                genK1(keyword, offset);
            } else if (val === 'k2') {
                genK2(keyword, offset);
            } else if (val === 'k3') {
                genK3(keyword, offset,shift);
            } else if (val === 'k4') {
                genK4(keyword, offset,keyword2,offset2);
            } else {
                genRandom();
            }
        }

        // Compute the replacement set for the 
        function setReplacement(cset,repl)
        {
            var i,len,errors;
            errors = '';
            replacement = cset;

            // Figure out what letters map to the destination letters.  Note that
            // the input chracterset alphabet may not be in the same order as the
            // actual alphabet.
            for(i = 0, len = repl.length; i < len; i++) {
                var repc = repl.substr(i,1);
                var orig = cset.substr(i,1);
                var pos = charset.indexOf(repc);
                replacement = replacement.substr(0,pos)+orig+replacement.substr(pos+1);
                // Just make sure that we don't happen to have the same character
                // at this position
                if (repc === orig) {
                    errors += repc;
                }
            }
            if (errors !== '') {
                console.log(errors);
                $(".err").text('Bad keyword/offset combo for letters: '+errors);
            }
        }

        function genK1(keyword,offset) {
            var repl = genKstring(keyword,offset);
            setReplacement(charset,repl);
        }

        function genK2(keyword,offset) {
            replacement = genKstring(keyword,offset);
        }
        function genK3(keyword,offset,shift) {
            var repl = genKstring(keyword,offset);
            var cset = repl.substr(shift)+repl.substr(0,shift);
            setReplacement(cset,repl);
        }
        function genK4(keyword,offset,keyword2,offset2) {
            var cset = genKstring(keyword,offset);
            var repl = genKstring(keyword2,offset2);
            setReplacement(cset,repl);
        }
        function genKstring(keyword,offset) {
            var unasigned = charset;
            var repl = "";
            var i, len;
            
            // Go through each character in the source string one at a time
            // and see if it is a legal character.  if we have not already seen
            // it, then remove it from the list of legal characters and add it
            // to the output string
            for (i = 0, len = keyword.length; i < len; i++) {
                var c = keyword.substr(i,1).toUpperCase();
                // Is it one of the characters we haven't used?
                var pos = unasigned.indexOf(c);
                if (pos >= 0) {
                    // we hadn't used it, so save it away and remove it from
                    // the list of ones we haven't used
                    repl += c;
                    unasigned = unasigned.substr(0,pos) + unasigned.substr(pos+1);
                }
            }
            repl = unasigned.substr(unasigned.length-offset) + repl + unasigned.substr(0,unasigned.length-offset);
            return repl;
        }
        // Gets a random replacement character from the remaining set of unassigned
        // characters
        function getRepl() {
            var sel = Math.floor(Math.random() * unasigned.length);
            var res = unasigned.substr(sel, 1);
            unasigned = unasigned.substr(0, sel) + unasigned.substr(sel + 1);
            return res;
        }
        // Generates a random replacement set of characters
        function genRandom() {
            unasigned = charset;
            replacement = "";
            var pos = 0;

            while (unasigned.length > 1) {
                var orig = charset.substr(pos, 1);
                var repl = getRepl();
                // If the replacement character is the same as the original
                // then we just get another one and put the replacement back at the end
                // This is guaranteed to be unique
                if (orig == repl) {
                    var newrepl = getRepl();
                    unasigned += repl;
                    repl = newrepl;
                }
                replacement += repl;
                pos++;
            }

            // Now we have to handle the special case of the last character
            if (charset.substr(pos, 1) == unasigned) {
                // Just pick a randome spot in what we have already done and
                // swap it.  We are guaranteed that it won't be the last character
                // since it matches already
                var sel = Math.floor(Math.random() * replacement.length);
                replacement = replacement.substr(0, sel) + unasigned + replacement.substr(sel + 1) + replacement.substr(sel, 1);
            } else {
                replacement += unasigned;
            }
        }

        // Using the currently selected replacement set, encodes a string
        function encode(str) {
            var res = "";
            var i, len;
            freq = [];
            for (i = 0, len = charset.length; i < len; i++) {
                freq[charset.substr(i, 1).toUpperCase()] = 0;
            }

            for (i = 0, len = str.length; i < len; i++) {
                var t = str.substr(i, 1).toUpperCase();
                var pos = charset.indexOf(t);
                if (pos >= 0) {
                    t = replacement.substr(pos, 1);
                    if (isNaN(freq[t])) {
                        freq[t] = 0;
                    }
                    freq[t]++;
                }
                res += t;
            }
            return res;
        }
        function calc() {
            $(".err").text('');
            var toencode = $('#toencode').val();
            console.log('encode=' + toencode);
            genMap();
            var res = encode(toencode);
            $("#answer").text(res);
            for (var c in freq) {
                if (freq.hasOwnProperty(c)) {
                    var subval = freq[c];
                    if (subval == 0) {
                        $('#f' + c).text('');
                    } else {
                        $('#f' + c).text(subval);
                    }
                    var pos = charset.indexOf(c);
                    var repl = replacement.substr(pos,1);
                    $('#r' + repl).text(c);
                }
            }
        }
        function setkvalinputs() {
            var val = $('input[name=enctype]:checked').val();
            if (val === 'random') {
                $(".kval").hide();
            } else {
                $(".kval").show();
            }
            if (val === 'k3') {
                $(".k3val").show();
            } else {
                $(".k3val").hide();
            }
            if (val === 'k4') {
                $(".k4val").show();
            } else {
                $(".k4val").hide();
            }
        }

        $(".spin").spinner({
            spin: function (event, ui) {
                if (ui.value >= charset.length) {
                    $(this).spinner("value", 0);
                    return false;
                } else if (ui.value < 0) {
                    $(this).spinner("value", charset.length - 1);
                    return false;
                }
            }
        });
        $(document).ready(function () {
            $('input[type=radio][name=enctype]').change(function () {
                setkvalinputs();
            });
            setkvalinputs();
        });
        $(".inp").change(function () {
            calc();
        });
        $(".inp").blur(function () {
            calc();
        });
        $('#encrypt').button().click(function () {
            calc();
        })
    </script>
</body>

</html>